@implements IEditorParameters

@inject MudBlazorViewTypeProvider ViewTypeProvider

@* <span class="dev">
    @(ViewModel.CanEdit ? "" : "(Cannot edit)")
</span>
<span class="dev">
    @(ViewModel.ReadOnly ? "(ReadOnly)" : "")
</span> *@

@if (ViewModel.ReadOnly || !ViewModel.CanEdit)
{
    @ViewModel.DisplayValue
}
else if (ViewModel.Getter != null)
{
    if (ViewModel.Type == typeof(bool))
    {
        <MudSwitch @bind-Checked="ViewModel.Getter.ReadCacheValue" />
    }
    else if (ViewModel.Type == typeof(string))
    {
        <MudTextField T=Object @bind-Value="ViewModel.Value"  />
    }
    else if (ViewModel.Type == typeof(int))
    {
        <MudNumericField @bind-Value="ViewModel.Getter.ReadCacheValue" />
    }
    else
    {
        <DynamicComponent Type="@EditorType" Parameters="@Parameters" ></DynamicComponent>
        @* @ViewModel.DisplayValue *@
    }
}

@code {

    [Parameter]
    public PropertyVM? ViewModel { get; set; }


    public Type? EditorType => ViewTypeProvider.GetViewType(ViewModel.Type) ?? FallbackEditorType;

    public Type FallbackEditorType => typeof(FallbackEditor);

    public string Value { get; set; } = "abc";


    public IDictionary<string, object?>? Parameters => ComponentParameters<IEditorParameters>.ToParameterDictionary(this);

    
}